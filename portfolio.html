<!DOCTYPE html>
<html class="has-sidemenu" lang="ko-KR" dir="ltr">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="민족통일청년회 영동군 지부 활동 갤러리 - 다양한 활동과 행사 사진">
    <meta name="keywords" content="민족통일청년회, 영동군, 활동 갤러리, 사진, 행사">


    <!-- ===============================================-->
    <!--    Document Title-->
    <!-- ===============================================-->
    <title>활동 갤러리 | 민족통일청년회 영동군</title>


    <!-- ===============================================-->
    <!--    Favicons-->
    <!-- ===============================================-->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicons/favicon-16x16.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicons/favicon.ico">
    <link rel="manifest" href="assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="assets/img/favicons/mstile-150x150.png">
    <meta name="theme-color" content="#ffffff">


    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link href="vendors/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="vendors/loaders.css/loaders.min.css" rel="stylesheet" type="text/css">
    <link href="vendors/bigpicture/bigPicture.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=PT+Mono%7cPT+Serif:400,400i%7cLato:100,300,400,700,800,900" rel="stylesheet">
    <link href="assets/css/theme.css" rel="stylesheet" />
    <link href="assets/css/user.css" rel="stylesheet" />

  </head>


  <body class="overflow-hidden-x">


    <nav class="fancynavbar fancynavbar-expand-lg" data-zanim-lg='{"from":{"opacity":1,"x":70},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}' data-zanim-xs='{"from":{"opacity":1,"y":-37},"to":{"opacity":1,"y":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}' data-zanim-trigger="scroll" data-exclusive="true">
      <div class="fancynavbar-togglerbar"><a class="fancynavbar-brand" href="index.html"><img class="fancynavbar-brand-img" src="assets/img/logo-sparrow-invert.svg" alt="" width="30" height="30" data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}' data-zanim-trigger="scroll" />

          <!--You can use icon or text logo as well-->
          <!--<span class='fab fa-superpowers fs-6'></span>-->
          <!--<span class='logo-sparrow'>S</span>--></a>
        <div class="fancynavbar-toggler">
          <svg class="fancynavbar-toggler-icon" viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg" data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.5}' data-zanim-trigger="scroll">
            <path id="path-top" d="M20,25c0,0,22,0,30,0c16,0,18.89,40.71-.15,21.75C38.7,35.65,19.9,16.8,19.9,16.8"></path>
            <path id="path-middle" d="M20,32h30"></path>
            <path id="path-bottom" d="M19.9,46.98c0,0,18.8-18.85,29.95-29.95C68.89-1.92,66,38.78,50,38.78c-8,0-30,0-30,0"></path>
          </svg>
        </div>
        <div class="fancynavbar-addon fancynavbar-addon-height" data-zanim-lg='{"from":{"opacity":1,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}' data-zanim-trigger="scroll"><a class="fancynavbar-addon-item" href="http://www.mintong.or.kr/mt/main" target="_blank" rel="noopener" title="민족통일협의회"><span class="fas fa-globe"></span></a><a class="fancynavbar-addon-item" href="contact.html" title="연락처"><span class="fas fa-envelope"></span></a>
        </div>
      </div>
      <div class="fancynavbar-collapse">
        <ul class="fancynavbar-nav">
          <li class="fancynav-item"><a class="fancynav-link" href="index.html"><span class="fancynav-link-content">홈</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="about.html"><span class="fancynav-link-content">협의회 소개</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="services.html"><span class="fancynav-link-content">회계</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="members.html"><span class="fancynav-link-content">회원소개</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="news.html"><span class="fancynav-link-content">활동 소식</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link active" href="portfolio.html"><span class="fancynav-link-content">활동 갤러리</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="events.html"><span class="fancynav-link-content">행사&사진</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="contact.html"><span class="fancynav-link-content">연락처</span></a></li>
        </ul>
      </div>
    </nav>



    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class="main min-vh-100" id="top">


      <!-- ============================================-->
      <!-- Preloader ==================================-->
      <div class="preloader" id="preloader">
        <div class="loader">
          <div class="line-scale-pulse-out-rapid">
            <div> </div>
            <div></div>
            <div></div>
            <div></div>
            <div> </div>
          </div>
        </div>
      </div>
      <!-- ============================================-->
      <!-- End of Preloader ===========================-->


      <!-- ============================================-->
      <!-- <section> begin ============================-->
      <section class="py-7 py-md-9" id="page-portfolio">

        <div class="container">
          <div class="row flex-center">
            <div class="col-12 text-center mb-5">
              <h1 class="fs-5 fs-md-4 text-decoration-underline d-inline-block mb-3">활동 갤러리</h1>
              <p class="text-body-tertiary mt-3">민족통일청년회 영동군 지부의 다양한 활동을 사진으로 만나보세요</p>
            </div>
          </div>

          <!-- 필터 버튼 -->
          <div class="row">
            <div class="col-12">
              <ul class="nav font-secondary mb-4 justify-content-center" data-filter-nav="data-filter-nav">
                <li class="nav-item"><a class="nav-link isotope-nav active" href="#!" data-filter="*">전체</a></li>
                <li class="nav-item"><a class="nav-link isotope-nav" href="#!" data-filter=".event">행사</a></li>
                <li class="nav-item"><a class="nav-link isotope-nav" href="#!" data-filter=".meeting">모임</a></li>
                <li class="nav-item"><a class="nav-link isotope-nav" href="#!" data-filter=".volunteer">봉사</a></li>
                <li class="nav-item"><a class="nav-link isotope-nav" href="#!" data-filter=".education">교육</a></li>
              </ul>
            </div>
          </div>

          <!-- 갤러리 로딩 -->
          <div id="galleryLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">로딩중...</span>
            </div>
          </div>

          <!-- 사진 갤러리 -->
          <div class="row g-3" id="portfolio-gallery" data-zanim-timeline="{}" data-zanim-trigger="scroll" data-isotope='{"layoutMode":"packery"}'>
          </div>

          <!-- 사진 업로드 버튼 -->
          <div class="text-center mt-4">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
              <span class="fas fa-plus me-2"></span>사진 업로드
            </button>
          </div>
        </div>
        <!-- end of .container-->

      </section>
      <!-- <section> close ============================-->
      <!-- ============================================-->


    </main>
    <!-- ===============================================-->
    <!--    End of Main Content-->
    <!-- ===============================================-->

    <!-- 업로드 모달 -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">사진 업로드</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="uploadForm">
              <div class="mb-3">
                <label for="galleryImage" class="form-label fw-bold">이미지 <span class="text-danger">*</span></label>
                <input type="file" class="form-control" id="galleryImage" accept="image/*" required>
                <small class="text-body-secondary">JPG, PNG, GIF 형식 (최대 5MB)</small>
              </div>
              <div class="mb-3">
                <label for="galleryCaption" class="form-label fw-bold">설명 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="galleryCaption" required placeholder="사진 설명">
              </div>
              <div class="mb-3">
                <label for="galleryCategory" class="form-label fw-bold">카테고리 <span class="text-danger">*</span></label>
                <select class="form-select" id="galleryCategory" required>
                  <option value="event">행사</option>
                  <option value="meeting">모임</option>
                  <option value="volunteer">봉사</option>
                  <option value="education">교육</option>
                </select>
              </div>
              <div id="uploadPreview" class="mb-3" style="display:none;">
                <img id="uploadPreviewImg" src="" alt="미리보기" class="img-thumbnail w-100">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            <button type="button" class="btn btn-primary" onclick="uploadGalleryImage()">
              <span class="fas fa-upload me-2"></span>업로드
            </button>
          </div>
        </div>
      </div>
    </div>




    <!--===============================================-->
    <!--    Footer-->
    <!--===============================================-->
    <footer class="footer bg-black text-body-secondary py-4 font-secondary text-center overflow-hidden">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-4 order-lg-2 position-relative"><a class="indicator indicator-up" href="#top"><span class="indicator-arrow indicator-arrow-one" data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":0.9}'></span><span class="indicator-arrow indicator-arrow-two" data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":1.05}'></span></a></div>
          <div class="col-lg-4 text-lg-start mt-4 mt-lg-0">
            <p class="fs-10 ls fw-bold mb-0">Copyright &copy; 2025 민족통일청년회 영동군</p>
            <p class="fs-10 mb-0 mt-2"><a href="http://www.mintong.or.kr/mt/main" target="_blank" class="text-body-secondary">민족통일협의회</a></p>
          </div>
          <div class="col-lg-4 text-lg-end order-lg-2 mt-2 mt-lg-0">
            <p class="fs-10 mb-0">충청북도 영동군 | 문의: conexus25@conexus.co.kr</p>
          </div>
        </div>
      </div>
    </footer>


    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
    <script src="vendors/popper/popper.min.js"></script>
    <script src="vendors/bootstrap/bootstrap.min.js"></script>
    <script src="vendors/anchorjs/anchor.min.js"></script>
    <script src="vendors/is/is.min.js"></script>
    <script src="vendors/isotope-layout/isotope.pkgd.min.js"> </script>
    <script src="vendors/isotope-packery/packery-mode.pkgd.min.js"> </script>
    <script src="vendors/swiper/swiper-bundle.min.js"></script>
    <script src="vendors/bigpicture/BigPicture.js"></script>
    <script src="vendors/fontawesome/all.min.js"></script>
    <script src="vendors/lodash/lodash.min.js"></script>
    <script src="vendors/imagesloaded/imagesloaded.pkgd.js"></script>
    <script src="vendors/gsap/gsap.js"></script>
    <script src="vendors/gsap/customEase.js"></script>
    <script src="vendors/gsap/drawSVGPlugin.js"></script>
<script src="assets/js/theme.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-config.js"></script>

    <script>
      // 갤러리 로드 (event_photos 테이블에서)
      async function loadGallery() {
        const loadingEl = document.getElementById('galleryLoading');
        const galleryContainer = document.getElementById('portfolio-gallery');

        try {
          // event_photos와 news(행사) 테이블 조인해서 가져오기
          const { data: images, error } = await supabase
            .from('event_photos')
            .select(`
              *,
              news:event_id (title, category)
            `)
            .order('created_at', { ascending: false });

          if (error) throw error;

          if (loadingEl) loadingEl.style.display = 'none';

          if (!images || images.length === 0) {
            galleryContainer.innerHTML = `
              <div class="col-12 text-center py-5 text-body-secondary">
                <p class="fs-4"><span class="fas fa-images me-2"></span>등록된 사진이 없습니다.</p>
              </div>
            `;
            return;
          }

          galleryContainer.innerHTML = '';

          images.forEach((img, index) => {
            const delay = (index * 0.1).toFixed(1);
            const caption = img.caption || (img.news ? img.news.title : '행사 사진');
            const itemHTML = `
              <div class="col-6 col-md-4 col-lg-3 isotope-item">
                <a href="#!" data-bp="${img.image_url}" data-bigpicture='{"gallery":"#portfolio-gallery"}' data-caption="${escapeHtml(caption)}">
                  <img class="rounded w-100" style="height:250px;object-fit:cover;" src="${img.image_url}" alt="${escapeHtml(caption)}" data-zanim-xs='{"animation":"zoom-in","delay":${delay}}' />
                </a>
              </div>
            `;
            galleryContainer.insertAdjacentHTML('beforeend', itemHTML);
          });

          // Isotope 초기화
          setTimeout(() => {
            const iso = new Isotope(galleryContainer, {
              itemSelector: '.isotope-item',
              layoutMode: 'packery'
            });

            // 필터 버튼 이벤트
            document.querySelectorAll('[data-filter]').forEach(btn => {
              btn.addEventListener('click', function(e) {
                e.preventDefault();
                iso.arrange({ filter: this.getAttribute('data-filter') });
                document.querySelectorAll('.isotope-nav').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
              });
            });

            // BigPicture 재초기화
            if (window.BigPicture) {
              document.querySelectorAll('[data-bp]').forEach(el => {
                el.addEventListener('click', function(e) {
                  e.preventDefault();
                  BigPicture({
                    el: this,
                    gallery: '#portfolio-gallery'
                  });
                });
              });
            }
          }, 100);
        } catch (error) {
          console.error('갤러리 로드 오류:', error);
          if (loadingEl) loadingEl.style.display = 'none';
          galleryContainer.innerHTML = `
            <div class="col-12 text-center py-5 text-danger">
              <p><span class="fas fa-exclamation-triangle me-2"></span>갤러리를 불러오는데 실패했습니다.</p>
            </div>
          `;
        }
      }

      // 이미지 업로드
      async function uploadGalleryImage() {
        const fileInput = document.getElementById('galleryImage');
        const caption = document.getElementById('galleryCaption').value;
        const category = document.getElementById('galleryCategory').value;

        if (!fileInput.files[0] || !caption) {
          alert('이미지와 설명을 입력해주세요.');
          return;
        }

        const file = fileInput.files[0];
        if (file.size > 5 * 1024 * 1024) {
          alert('이미지 크기는 5MB 이하여야 합니다.');
          return;
        }

        try {
          // 파일 업로드
          const fileExt = file.name.split('.').pop();
          const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;
          const filePath = `gallery/${fileName}`;

          const { error: uploadError } = await supabase.storage
            .from('events')
            .upload(filePath, file);

          if (uploadError) throw uploadError;

          // URL 가져오기
          const { data: urlData } = supabase.storage
            .from('events')
            .getPublicUrl(filePath);

          // DB에 저장
          const { error: dbError } = await supabase
            .from('gallery')
            .insert([{
              image_url: urlData.publicUrl,
              caption: caption,
              category: category
            }]);

          if (dbError) throw dbError;

          alert('사진이 업로드되었습니다!');

          // 모달 닫기 및 폼 초기화
          bootstrap.Modal.getInstance(document.getElementById('uploadModal')).hide();
          document.getElementById('uploadForm').reset();
          document.getElementById('uploadPreview').style.display = 'none';

          // 갤러리 새로고침
          loadGallery();
        } catch (error) {
          console.error('업로드 오류:', error);
          alert('업로드에 실패했습니다: ' + error.message);
        }
      }

      // 유틸리티
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // 미리보기
      document.getElementById('galleryImage').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('uploadPreviewImg').src = e.target.result;
            document.getElementById('uploadPreview').style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });

      // 페이지 로드
      document.addEventListener('DOMContentLoaded', async () => {
        // Supabase 준비 대기
        try {
          if (typeof waitForSupabase === 'function') {
            await waitForSupabase(5000);
          }
        } catch (error) {
          console.warn('Supabase 로딩 실패:', error.message);
        }

        if (supabase) {
          loadGallery();
        } else {
          const loadingEl = document.getElementById('galleryLoading');
          const container = document.getElementById('galleryContainer');
          if (loadingEl) loadingEl.style.display = 'none';
          if (container) {
            container.innerHTML = `
              <div class="col-12 text-center py-5 text-body-secondary">
                <p><span class="fas fa-exclamation-triangle me-2"></span>데이터를 불러올 수 없습니다.</p>
                <button class="btn btn-primary mt-3" onclick="location.reload()">새로고침</button>
              </div>
            `;
          }
        }
      });
    </script>

  </body>

</html>