<!DOCTYPE html>
<html class="has-sidemenu" lang="ko-KR" dir="ltr">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="민족통일청년회 영동군 지부 - 회계 관리">
    <meta name="keywords" content="민족통일청년회, 영동군, 회계, 회비, 지출">

    <title>회계 | 민족통일청년회 영동군</title>

    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicons/favicon-16x16.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicons/favicon.ico">
    <link rel="manifest" href="assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="assets/img/favicons/mstile-150x150.png">
    <meta name="theme-color" content="#ffffff">

    <link href="vendors/loaders.css/loaders.min.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=PT+Mono%7cPT+Serif:400,400i%7cLato:100,300,400,700,800,900" rel="stylesheet">
    <link href="assets/css/theme.css" rel="stylesheet" />
    <link href="assets/css/user.css" rel="stylesheet" />

    <style>
      /* 회계 페이지 스타일 - 사이트 컨셉에 맞춤 */
      .balance-display {
        text-align: center;
        padding: 2rem;
        border: 2px solid #000;
        margin-bottom: 2rem;
      }
      .balance-display .balance-label {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 0.5rem;
      }
      .balance-display .balance-amount {
        font-size: 2.5rem;
        font-weight: 300;
        letter-spacing: -1px;
      }
      .balance-display .balance-year {
        font-size: 0.85rem;
        color: #999;
        margin-top: 0.5rem;
      }

      .summary-row {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }
      .summary-item {
        text-align: center;
        min-width: 120px;
      }
      .summary-item .label {
        font-size: 0.8rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .summary-item .value {
        font-size: 1.5rem;
        font-weight: 300;
      }
      .summary-item .value.income { color: #2e7d32; }
      .summary-item .value.expense { color: #c62828; }

      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .section-title {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #333;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #dee2e6;
      }

      .transaction-list {
        border: 1px solid #dee2e6;
      }
      .transaction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s;
      }
      .transaction-item:last-child {
        border-bottom: none;
      }
      .transaction-item:hover {
        background-color: #f8f9fa;
      }
      .transaction-item .info {
        flex: 1;
      }
      .transaction-item .date {
        font-size: 0.8rem;
        color: #999;
      }
      .transaction-item .desc {
        font-weight: 500;
      }
      .transaction-item .category {
        font-size: 0.75rem;
        color: #6c757d;
      }
      .transaction-item .amount {
        font-weight: 500;
        min-width: 100px;
        text-align: right;
      }
      .transaction-item .amount.income { color: #2e7d32; }
      .transaction-item .amount.expense { color: #c62828; }
      .transaction-item .delete-btn {
        margin-left: 1rem;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .transaction-item:hover .delete-btn {
        opacity: 1;
      }

      .year-tabs {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
      }
      .year-tabs .btn {
        min-width: 80px;
      }
      .year-tabs .btn.active {
        background-color: #000;
        border-color: #000;
        color: #fff;
      }

      .view-tabs {
        display: flex;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 2rem;
      }
      .view-tabs .tab-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        background: none;
        font-size: 0.9rem;
        color: #6c757d;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
        transition: all 0.2s;
      }
      .view-tabs .tab-btn:hover {
        color: #333;
      }
      .view-tabs .tab-btn.active {
        color: #000;
        border-bottom-color: #000;
      }

      .dues-list {
        border: 1px solid #dee2e6;
      }
      .dues-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid #eee;
      }
      .dues-item:last-child {
        border-bottom: none;
      }
      .dues-item .member-name {
        font-weight: 500;
        min-width: 80px;
      }
      .dues-item .member-role {
        font-size: 0.8rem;
        color: #6c757d;
        flex: 1;
        margin-left: 1rem;
      }
      .dues-item .status {
        font-size: 0.8rem;
        padding: 0.25rem 0.75rem;
        border-radius: 2px;
      }
      .dues-item .status.paid {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .dues-item .status.unpaid {
        background: #ffebee;
        color: #c62828;
      }
      .dues-item .action-btn {
        margin-left: 1rem;
      }

      .dues-summary {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: #f8f9fa;
      }
      .dues-summary-item {
        text-align: center;
      }
      .dues-summary-item .count {
        font-size: 2rem;
        font-weight: 300;
      }
      .dues-summary-item .label {
        font-size: 0.8rem;
        color: #6c757d;
      }

      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #999;
      }

      .utility-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .tab-content-area {
        display: none;
      }
      .tab-content-area.active {
        display: block;
      }

      /* 모바일 반응형 */
      @media (max-width: 768px) {
        .balance-display {
          padding: 1.5rem;
        }
        .balance-display .balance-amount {
          font-size: 1.75rem;
        }
        .summary-row {
          gap: 1rem;
        }
        .summary-item .value {
          font-size: 1.25rem;
        }
        .action-buttons {
          flex-direction: column;
        }
        .action-buttons .btn {
          width: 100%;
        }
        .transaction-item {
          flex-wrap: wrap;
          gap: 0.5rem;
        }
        .transaction-item .amount {
          min-width: auto;
        }
        .transaction-item .delete-btn {
          opacity: 1;
        }
        .dues-item {
          flex-wrap: wrap;
          gap: 0.5rem;
        }
        .dues-item .member-role {
          display: none;
        }
        .view-tabs .tab-btn {
          padding: 0.5rem 1rem;
          font-size: 0.85rem;
        }
        .utility-bar {
          flex-direction: column;
          align-items: stretch;
        }
      }
    </style>

  </head>


  <body class="overflow-hidden-x">

    <nav class="fancynavbar fancynavbar-expand-lg" data-zanim-lg='{"from":{"opacity":1,"x":70},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}' data-zanim-xs='{"from":{"opacity":1,"y":-37},"to":{"opacity":1,"y":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}' data-zanim-trigger="scroll" data-exclusive="true">
      <div class="fancynavbar-togglerbar"><a class="fancynavbar-brand" href="index.html"><img class="fancynavbar-brand-img" src="assets/img/logo-sparrow-invert.svg" alt="" width="30" height="30" data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}' data-zanim-trigger="scroll" /></a>
        <div class="fancynavbar-toggler">
          <svg class="fancynavbar-toggler-icon" viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg" data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.5}' data-zanim-trigger="scroll">
            <path id="path-top" d="M20,25c0,0,22,0,30,0c16,0,18.89,40.71-.15,21.75C38.7,35.65,19.9,16.8,19.9,16.8"></path>
            <path id="path-middle" d="M20,32h30"></path>
            <path id="path-bottom" d="M19.9,46.98c0,0,18.8-18.85,29.95-29.95C68.89-1.92,66,38.78,50,38.78c-8,0-30,0-30,0"></path>
          </svg>
        </div>
        <div class="fancynavbar-addon fancynavbar-addon-height" data-zanim-lg='{"from":{"opacity":1,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}' data-zanim-trigger="scroll"><a class="fancynavbar-addon-item" href="http://www.mintong.or.kr/mt/main" target="_blank" rel="noopener" title="민족통일협의회"><span class="fas fa-globe"></span></a><a class="fancynavbar-addon-item" href="contact.html" title="연락처"><span class="fas fa-envelope"></span></a>
        </div>
      </div>
      <div class="fancynavbar-collapse">
        <ul class="fancynavbar-nav">
          <li class="fancynav-item"><a class="fancynav-link" href="index.html"><span class="fancynav-link-content">홈</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="about.html"><span class="fancynav-link-content">협의회 소개</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link active" href="services.html"><span class="fancynav-link-content">회계</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="members.html"><span class="fancynav-link-content">회원소개</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="board.html"><span class="fancynav-link-content">회원게시판</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="news.html"><span class="fancynav-link-content">활동 소식</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="events.html"><span class="fancynav-link-content">행사&사진</span></a></li>
          <li class="fancynav-item"><a class="fancynav-link" href="contact.html"><span class="fancynav-link-content">연락처</span></a></li>
        </ul>
      </div>
    </nav>


    <main class="main min-vh-100" id="top">

      <div class="preloader" id="preloader">
        <div class="loader">
          <div class="line-scale-pulse-out-rapid">
            <div> </div>
            <div></div>
            <div></div>
            <div></div>
            <div> </div>
          </div>
        </div>
      </div>

      <section class="py-6">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">

                  <!-- 페이지 제목 -->
                  <div class="mb-5">
                    <div class="overflow-hidden">
                      <h1 class="fs-6 fs-sm-5"><span class="text-decoration-underline mb-4" data-zanim-xs='{"delay":0.1}' data-zanim-trigger="scroll">회계 관리</span></h1>
                    </div>
                    <p class="mt-3 text-body-secondary" data-zanim-xs='{"delay":0.2}' data-zanim-trigger="scroll">민족통일청년회 영동군 지부의 회계 현황을 관리합니다.</p>
                  </div>

                  <!-- 연도 선택 -->
                  <div class="year-tabs" data-zanim-xs='{"delay":0.3}' data-zanim-trigger="scroll">
                    <button class="btn btn-outline-dark active" data-year="2026">2026</button>
                    <button class="btn btn-outline-dark" data-year="2025">2025</button>
                  </div>

                  <!-- 잔고 표시 -->
                  <div class="balance-display" data-zanim-xs='{"delay":0.4}' data-zanim-trigger="scroll">
                    <div class="balance-label">현재 잔고</div>
                    <div class="balance-amount" id="currentBalance">0원</div>
                    <div class="balance-year" id="balanceYear">2025년 기준</div>
                  </div>

                  <!-- 수입/지출 요약 -->
                  <div class="summary-row" data-zanim-xs='{"delay":0.5}' data-zanim-trigger="scroll">
                    <div class="summary-item">
                      <div class="label">수입</div>
                      <div class="value income" id="totalIncome">0원</div>
                    </div>
                    <div class="summary-item">
                      <div class="label">지출</div>
                      <div class="value expense" id="totalExpense">0원</div>
                    </div>
                  </div>

                  <!-- 입력 버튼 -->
                  <div class="action-buttons" data-zanim-xs='{"delay":0.6}' data-zanim-trigger="scroll">
                    <button class="btn btn-outline-dark" id="addIncomeBtn">
                      <span class="fas fa-plus me-2"></span>수입 추가
                    </button>
                    <button class="btn btn-outline-dark" id="addExpenseBtn">
                      <span class="fas fa-minus me-2"></span>지출 추가
                    </button>
                  </div>

                  <hr class="my-5" />

                  <!-- 탭 메뉴 -->
                  <div class="view-tabs">
                    <button class="tab-btn active" data-tab="transactions">거래 내역</button>
                    <button class="tab-btn" data-tab="dues">회비 납부현황</button>
                  </div>

                  <!-- 거래 내역 탭 -->
                  <div class="tab-content-area active" id="transactionsTab">
                    <div class="utility-bar">
                      <span class="text-body-secondary" id="transactionCount">0건</span>
                      <div>
                        <button class="btn btn-sm btn-outline-secondary" id="reportBtn">결산</button>
                        <button class="btn btn-sm btn-outline-secondary" id="excelBtn">엑셀</button>
                      </div>
                    </div>

                    <div class="transaction-list" id="transactionList">
                      <div class="empty-state">거래 내역이 없습니다.</div>
                    </div>
                  </div>

                  <!-- 회비 납부현황 탭 -->
                  <div class="tab-content-area" id="duesTab">
                    <div class="dues-summary">
                      <div class="dues-summary-item">
                        <div class="count" id="duesTotal">0</div>
                        <div class="label">전체</div>
                      </div>
                      <div class="dues-summary-item">
                        <div class="count" id="duesPaid" style="color:#2e7d32">0</div>
                        <div class="label">완납</div>
                      </div>
                      <div class="dues-summary-item">
                        <div class="count" id="duesUnpaid" style="color:#c62828">0</div>
                        <div class="label">미납</div>
                      </div>
                    </div>

                    <div class="utility-bar">
                      <span class="text-body-secondary" id="duesYearLabel">2025년 회비</span>
                      <button class="btn btn-sm btn-outline-secondary" id="duesExcelBtn">엑셀</button>
                    </div>

                    <div class="dues-list" id="duesList">
                      <div class="empty-state">회원 데이터를 불러오는 중...</div>
                    </div>
                  </div>

                  <hr class="my-5" />

                  <!-- 하단 유틸리티 -->
              <div class="text-center">
                <button class="btn btn-sm btn-outline-secondary" id="resetDataBtn">
                  <span class="fas fa-sync-alt me-1"></span>데이터 초기화
                </button>
              </div>

            </div>
          </div>
        </div>
      </section>


      <!-- 수입 추가 모달 -->
      <div class="modal fade" id="incomeModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">수입 추가</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="incomeForm">
                <div class="mb-3">
                  <label class="form-label">날짜</label>
                  <input type="date" class="form-control" id="incomeDate" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">분류</label>
                  <select class="form-select" id="incomeCategory" required>
                    <option value="회비">회비</option>
                    <option value="찬조금">찬조금</option>
                    <option value="기타">기타</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">내용</label>
                  <input type="text" class="form-control" id="incomeDescription" required placeholder="예: 김종원 회비 납부">
                </div>
                <div class="mb-3">
                  <label class="form-label">금액</label>
                  <input type="number" class="form-control" id="incomeAmount" min="0" step="1000" required placeholder="100000">
                </div>
                <div class="mb-3">
                  <label class="form-label">비고</label>
                  <input type="text" class="form-control" id="incomeNote" placeholder="(선택사항)">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
              <button type="button" class="btn btn-dark" id="saveIncomeBtn">저장</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 지출 추가 모달 -->
      <div class="modal fade" id="expenseModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">지출 추가</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="expenseForm">
                <div class="mb-3">
                  <label class="form-label">날짜</label>
                  <input type="date" class="form-control" id="expenseDate" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">분류</label>
                  <select class="form-select" id="expenseCategory" required>
                    <option value="행사비">행사비</option>
                    <option value="운영비">운영비</option>
                    <option value="기타">기타</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">내용</label>
                  <input type="text" class="form-control" id="expenseDescription" required placeholder="예: 12월 월례회 식대">
                </div>
                <div class="mb-3">
                  <label class="form-label">금액</label>
                  <input type="number" class="form-control" id="expenseAmount" min="0" step="1000" required placeholder="500000">
                </div>
                <div class="mb-3">
                  <label class="form-label">비고</label>
                  <input type="text" class="form-control" id="expenseNote" placeholder="(선택사항)">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
              <button type="button" class="btn btn-dark" id="saveExpenseBtn">저장</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 삭제 확인 모달 -->
      <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">삭제 확인</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <p id="deleteMessage">이 거래를 삭제하시겠습니까?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">취소</button>
              <button type="button" class="btn btn-dark btn-sm" id="confirmDeleteBtn">삭제</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 결산 보고서 모달 -->
      <div class="modal fade" id="reportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">수입·지출 결산서</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">

              <div class="text-center border-bottom pb-3 mb-4">
                <h4 class="mb-1" id="reportTitle">2025년도 수입·지출 결산서</h4>
                <p class="text-body-secondary mb-0">민족통일청년회 영동군 지부</p>
              </div>

              <div class="row">
                <div class="col-md-6 mb-4">
                  <h6 class="text-uppercase text-body-secondary mb-3">수입부</h6>
                  <table class="table table-sm">
                    <tbody id="reportIncomeBody"></tbody>
                    <tfoot>
                      <tr class="table-light">
                        <th>수입합계</th>
                        <th class="text-end" id="reportIncomeTotalSum">0원</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>

                <div class="col-md-6 mb-4">
                  <h6 class="text-uppercase text-body-secondary mb-3">지출부</h6>
                  <table class="table table-sm">
                    <tbody id="reportExpenseBody"></tbody>
                    <tfoot>
                      <tr class="table-light">
                        <th>지출합계</th>
                        <th class="text-end" id="reportExpenseTotalSum">0원</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <div class="p-3 bg-light text-center">
                <div class="row">
                  <div class="col-4">
                    <div class="text-body-secondary small">수입합계</div>
                    <div class="fs-5" id="reportFinalIncome">0원</div>
                  </div>
                  <div class="col-4">
                    <div class="text-body-secondary small">지출합계</div>
                    <div class="fs-5" id="reportFinalExpense">0원</div>
                  </div>
                  <div class="col-4">
                    <div class="text-body-secondary small">차기이월금</div>
                    <div class="fs-5 fw-bold" id="reportFinalBalance">0원</div>
                  </div>
                </div>
              </div>

              <div class="text-end mt-3 text-body-secondary small">
                작성일: <span id="reportDate"></span>
              </div>

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" id="reportExcelBtn">엑셀 저장</button>
              <button type="button" class="btn btn-outline-secondary" id="reportPrintBtn">인쇄</button>
              <button type="button" class="btn btn-dark" data-bs-dismiss="modal">닫기</button>
            </div>
          </div>
        </div>
      </div>

    </main>


    <footer class="footer bg-black text-body-secondary py-4 font-secondary text-center overflow-hidden">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-4 order-lg-2 position-relative"><a class="indicator indicator-up" href="#top"><span class="indicator-arrow indicator-arrow-one" data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":0.9}'></span><span class="indicator-arrow indicator-arrow-two" data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":1.05}'></span></a></div>
          <div class="col-lg-4 text-lg-start mt-4 mt-lg-0">
            <p class="fs-10 ls fw-bold mb-0">Copyright &copy; 2025 민족통일청년회 영동군</p>
            <p class="fs-10 mb-0 mt-2"><a href="http://www.mintong.or.kr/mt/main" target="_blank" class="text-body-secondary">민족통일협의회</a></p>
          </div>
          <div class="col-lg-4 text-lg-end order-lg-2 mt-2 mt-lg-0">
            <p class="fs-10 mb-0">충청북도 영동군 | 문의: conexus25@conexus.co.kr</p>
          </div>
        </div>
      </div>
    </footer>


    <script src="vendors/popper/popper.min.js"></script>
    <script src="vendors/bootstrap/bootstrap.min.js"></script>
    <script src="vendors/anchorjs/anchor.min.js"></script>
    <script src="vendors/is/is.min.js"></script>
    <script src="vendors/fontawesome/all.min.js"></script>
    <script src="vendors/lodash/lodash.min.js"></script>
    <script src="vendors/imagesloaded/imagesloaded.pkgd.js"></script>
    <script src="vendors/gsap/gsap.js"></script>
    <script src="vendors/gsap/customEase.js"></script>
    <script src="vendors/gsap/drawSVGPlugin.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/members-auto.js"></script>

    <script>
      // ========================================
      // 회계 관리 시스템
      // ========================================

      const STORAGE_KEY = 'mintong_accounting';
      const INITIAL_BALANCE = 3734393; // 초기 잔고 3,734,393원

      let currentYear = 2026;
      let deleteTargetId = null;

      function loadData() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          return JSON.parse(stored);
        }
        // 초기 데이터: 잔고 3,734,393원, 거래 없음
        return {
          initialBalance: INITIAL_BALANCE,
          transactions: []
        };
      }

      function saveData(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      let accountingData = loadData();

      function formatMoney(amount) {
        return new Intl.NumberFormat('ko-KR').format(amount) + '원';
      }

      function getNextId() {
        if (accountingData.transactions.length === 0) return 1;
        return Math.max(...accountingData.transactions.map(t => t.id)) + 1;
      }

      function getTransactionsByYear(year) {
        return accountingData.transactions
          .filter(t => t.date.startsWith(year.toString()))
          .sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      function calculateBalance(upToYear) {
        let balance = accountingData.initialBalance;
        const allTransactions = [...accountingData.transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
        for (const t of allTransactions) {
          const txYear = parseInt(t.date.substring(0, 4));
          if (txYear <= upToYear) {
            balance += t.type === 'income' ? t.amount : -t.amount;
          }
        }
        return balance;
      }

      function calculateYearSummary(year) {
        const transactions = getTransactionsByYear(year);
        let income = 0, expense = 0;
        for (const t of transactions) {
          if (t.type === 'income') income += t.amount;
          else expense += t.amount;
        }
        return { income, expense };
      }

      function renderTransactions(year) {
        const list = document.getElementById('transactionList');
        const transactions = getTransactionsByYear(year);

        if (transactions.length === 0) {
          list.innerHTML = '<div class="empty-state">거래 내역이 없습니다.</div>';
          document.getElementById('transactionCount').textContent = '0건';
          return;
        }

        let html = '';
        for (const t of transactions) {
          const typeClass = t.type === 'income' ? 'income' : 'expense';
          const prefix = t.type === 'income' ? '+' : '-';

          html += `
            <div class="transaction-item">
              <div class="info">
                <div class="date">${t.date} · ${t.category}</div>
                <div class="desc">${t.description}</div>
                ${t.note ? `<div class="category">${t.note}</div>` : ''}
              </div>
              <div class="amount ${typeClass}">${prefix}${formatMoney(t.amount)}</div>
              <button class="btn btn-sm btn-outline-secondary delete-btn" onclick="confirmDelete(${t.id}, '${t.description}')">
                <span class="fas fa-trash-alt"></span>
              </button>
            </div>
          `;
        }

        list.innerHTML = html;
        document.getElementById('transactionCount').textContent = `${transactions.length}건`;
      }

      function updateSummary(year) {
        const summary = calculateYearSummary(year);
        const balance = calculateBalance(year);

        document.getElementById('totalIncome').textContent = formatMoney(summary.income);
        document.getElementById('totalExpense').textContent = formatMoney(summary.expense);
        document.getElementById('currentBalance').textContent = formatMoney(balance);
        document.getElementById('balanceYear').textContent = `${year}년 기준`;
      }

      function loadAll(year) {
        renderTransactions(year);
        updateSummary(year);
      }

      function saveIncome() {
        const date = document.getElementById('incomeDate').value;
        const category = document.getElementById('incomeCategory').value;
        const description = document.getElementById('incomeDescription').value;
        const amount = parseInt(document.getElementById('incomeAmount').value);
        const note = document.getElementById('incomeNote').value;

        if (!date || !category || !description || !amount) {
          alert('필수 항목을 입력해주세요.');
          return;
        }

        accountingData.transactions.push({
          id: getNextId(), date, type: 'income', category, description, amount, note
        });
        saveData(accountingData);
        bootstrap.Modal.getInstance(document.getElementById('incomeModal')).hide();
        document.getElementById('incomeForm').reset();

        const txYear = parseInt(date.substring(0, 4));
        if (txYear !== currentYear) {
          currentYear = txYear;
          document.querySelectorAll('.year-tabs .btn').forEach(b => {
            b.classList.toggle('active', parseInt(b.dataset.year) === txYear);
          });
        }
        loadAll(currentYear);
      }

      function saveExpense() {
        const date = document.getElementById('expenseDate').value;
        const category = document.getElementById('expenseCategory').value;
        const description = document.getElementById('expenseDescription').value;
        const amount = parseInt(document.getElementById('expenseAmount').value);
        const note = document.getElementById('expenseNote').value;

        if (!date || !category || !description || !amount) {
          alert('필수 항목을 입력해주세요.');
          return;
        }

        accountingData.transactions.push({
          id: getNextId(), date, type: 'expense', category, description, amount, note
        });
        saveData(accountingData);
        bootstrap.Modal.getInstance(document.getElementById('expenseModal')).hide();
        document.getElementById('expenseForm').reset();

        const txYear = parseInt(date.substring(0, 4));
        if (txYear !== currentYear) {
          currentYear = txYear;
          document.querySelectorAll('.year-tabs .btn').forEach(b => {
            b.classList.toggle('active', parseInt(b.dataset.year) === txYear);
          });
        }
        loadAll(currentYear);
      }

      function confirmDelete(id, description) {
        deleteTargetId = id;
        document.getElementById('deleteMessage').textContent = `"${description}"을(를) 삭제하시겠습니까?`;
        new bootstrap.Modal(document.getElementById('deleteModal')).show();
      }

      function executeDelete() {
        if (deleteTargetId === null) return;
        accountingData.transactions = accountingData.transactions.filter(t => t.id !== deleteTargetId);
        saveData(accountingData);
        bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
        deleteTargetId = null;
        loadAll(currentYear);
      }

      // 엑셀 내보내기
      function exportToExcel() {
        const transactions = getTransactionsByYear(currentYear);
        if (transactions.length === 0) {
          alert('내보낼 거래 내역이 없습니다.');
          return;
        }

        let csv = '\uFEFF';
        csv += '민족통일청년회 영동군 지부 회계장부\n';
        csv += `${currentYear}년 거래 내역\n\n`;
        csv += '날짜,구분,분류,내용,금액,비고\n';

        for (const t of transactions) {
          const type = t.type === 'income' ? '수입' : '지출';
          const amount = t.type === 'income' ? t.amount : -t.amount;
          csv += `${t.date},${type},${t.category},"${t.description}",${amount},"${t.note || ''}"\n`;
        }

        const summary = calculateYearSummary(currentYear);
        csv += `\n,,,수입합계,${summary.income},\n`;
        csv += `,,,지출합계,${summary.expense},\n`;

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `회계장부_${currentYear}년.csv`;
        link.click();
      }

      // 결산 보고서
      function generateReport() {
        const year = currentYear;
        const transactions = getTransactionsByYear(year);

        document.getElementById('reportTitle').textContent = `${year}년도 수입·지출 결산서`;

        let carryOver = accountingData.initialBalance;
        const allTransactions = [...accountingData.transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
        for (const t of allTransactions) {
          if (parseInt(t.date.substring(0, 4)) < year) {
            carryOver += t.type === 'income' ? t.amount : -t.amount;
          }
        }

        const incomeByCategory = { '전기이월금': carryOver };
        const expenseByCategory = {};

        for (const t of transactions) {
          if (t.type === 'income') {
            const cat = t.category + '수입';
            incomeByCategory[cat] = (incomeByCategory[cat] || 0) + t.amount;
          } else {
            expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
          }
        }

        let incomeHtml = '', incomeTotal = 0;
        for (const [cat, amount] of Object.entries(incomeByCategory)) {
          incomeTotal += amount;
          incomeHtml += `<tr><td>${cat}</td><td class="text-end">${formatMoney(amount)}</td></tr>`;
        }
        document.getElementById('reportIncomeBody').innerHTML = incomeHtml;
        document.getElementById('reportIncomeTotalSum').textContent = formatMoney(incomeTotal);

        let expenseHtml = '', expenseTotal = 0;
        for (const [cat, amount] of Object.entries(expenseByCategory)) {
          expenseTotal += amount;
          expenseHtml += `<tr><td>${cat}</td><td class="text-end">${formatMoney(amount)}</td></tr>`;
        }
        if (Object.keys(expenseByCategory).length === 0) {
          expenseHtml = '<tr><td colspan="2" class="text-center text-body-secondary">지출 내역 없음</td></tr>';
        }
        document.getElementById('reportExpenseBody').innerHTML = expenseHtml;
        document.getElementById('reportExpenseTotalSum').textContent = formatMoney(expenseTotal);

        document.getElementById('reportFinalIncome').textContent = formatMoney(incomeTotal);
        document.getElementById('reportFinalExpense').textContent = formatMoney(expenseTotal);
        document.getElementById('reportFinalBalance').textContent = formatMoney(incomeTotal - expenseTotal);
        document.getElementById('reportDate').textContent = new Date().toLocaleDateString('ko-KR');

        new bootstrap.Modal(document.getElementById('reportModal')).show();
      }

      function printReport() {
        const modalBody = document.querySelector('#reportModal .modal-body').innerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <!DOCTYPE html><html><head><title>결산서</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
          <style>body{padding:20px}</style></head>
          <body>${modalBody}<script>window.onload=function(){window.print();}<\/script></body></html>
        `);
        printWindow.document.close();
      }

      function exportReportToExcel() {
        const year = currentYear;
        let carryOver = accountingData.initialBalance;
        const allTransactions = [...accountingData.transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
        for (const t of allTransactions) {
          if (parseInt(t.date.substring(0, 4)) < year) {
            carryOver += t.type === 'income' ? t.amount : -t.amount;
          }
        }

        const transactions = getTransactionsByYear(year);
        const incomeByCategory = { '전기이월금': carryOver };
        const expenseByCategory = {};

        for (const t of transactions) {
          if (t.type === 'income') {
            incomeByCategory[t.category + '수입'] = (incomeByCategory[t.category + '수입'] || 0) + t.amount;
          } else {
            expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
          }
        }

        let csv = '\uFEFF';
        csv += `${year}년도 수입·지출 결산서\n민족통일청년회 영동군 지부\n\n`;
        csv += '[수입부]\n항목,금액\n';
        let incomeTotal = 0;
        for (const [cat, amount] of Object.entries(incomeByCategory)) {
          incomeTotal += amount;
          csv += `${cat},${amount}\n`;
        }
        csv += `수입합계,${incomeTotal}\n\n`;

        csv += '[지출부]\n항목,금액\n';
        let expenseTotal = 0;
        for (const [cat, amount] of Object.entries(expenseByCategory)) {
          expenseTotal += amount;
          csv += `${cat},${amount}\n`;
        }
        csv += `지출합계,${expenseTotal}\n\n`;
        csv += `[결산]\n수입합계,${incomeTotal}\n지출합계,${expenseTotal}\n차기이월금,${incomeTotal - expenseTotal}\n`;

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `결산서_${year}년.csv`;
        link.click();
      }

      // ========================================
      // 회비 납부 관리
      // ========================================

      const DUES_STORAGE_KEY = 'mintong_dues';
      const DEFAULT_DUES_AMOUNT = 240000; // 연회비 24만원

      function loadDuesData() {
        const stored = localStorage.getItem(DUES_STORAGE_KEY);
        if (stored) return JSON.parse(stored);
        // 초기 데이터: 비어있음 (전원 미납 상태)
        return {};
      }

      function saveDuesData(data) {
        localStorage.setItem(DUES_STORAGE_KEY, JSON.stringify(data));
      }

      let duesData = loadDuesData();

      function renderDuesTable(year) {
        const list = document.getElementById('duesList');

        if (typeof membersData === 'undefined' || membersData.length === 0) {
          list.innerHTML = '<div class="empty-state">회원 데이터를 불러올 수 없습니다.</div>';
          return;
        }

        const yearKey = year.toString();
        if (!duesData[yearKey]) duesData[yearKey] = {};

        let html = '';
        let paidCount = 0, unpaidCount = 0;

        for (const member of membersData) {
          const payment = duesData[yearKey][member.name];
          const isPaid = payment && payment.paid;

          if (isPaid) paidCount++;
          else unpaidCount++;

          const statusClass = isPaid ? 'paid' : 'unpaid';
          const statusText = isPaid ? '완납' : '미납';

          html += `
            <div class="dues-item">
              <div class="member-name">${member.name}</div>
              <div class="member-role">${member.role}</div>
              <span class="status ${statusClass}">${statusText}</span>
              ${isPaid
                ? `<button class="btn btn-sm btn-outline-secondary action-btn" onclick="cancelPayment('${member.name}')">취소</button>`
                : `<button class="btn btn-sm btn-dark action-btn" onclick="recordPayment('${member.name}')">납부</button>`
              }
            </div>
          `;
        }

        list.innerHTML = html;
        document.getElementById('duesTotal').textContent = membersData.length;
        document.getElementById('duesPaid').textContent = paidCount;
        document.getElementById('duesUnpaid').textContent = unpaidCount;
        document.getElementById('duesYearLabel').textContent = `${year}년 회비`;
      }

      function recordPayment(memberName) {
        const year = currentYear.toString();
        const today = new Date().toISOString().split('T')[0];

        if (!duesData[year]) duesData[year] = {};
        duesData[year][memberName] = { paid: true, date: today, amount: DEFAULT_DUES_AMOUNT };
        saveDuesData(duesData);

        accountingData.transactions.push({
          id: getNextId(),
          date: today,
          type: 'income',
          category: '회비',
          description: `${memberName} 회비 납부`,
          amount: DEFAULT_DUES_AMOUNT,
          note: `${currentYear}년 연회비`
        });
        saveData(accountingData);

        renderDuesTable(currentYear);
        loadAll(currentYear);
      }

      function cancelPayment(memberName) {
        if (!confirm(`${memberName}님의 납부를 취소하시겠습니까?`)) return;

        const year = currentYear.toString();
        if (duesData[year] && duesData[year][memberName]) {
          delete duesData[year][memberName];
          saveDuesData(duesData);
        }

        const idx = accountingData.transactions.findIndex(t =>
          t.date.startsWith(year) && t.category === '회비' && t.description === `${memberName} 회비 납부`
        );
        if (idx !== -1) {
          accountingData.transactions.splice(idx, 1);
          saveData(accountingData);
        }

        renderDuesTable(currentYear);
        loadAll(currentYear);
      }

      function exportDuesToExcel() {
        const year = currentYear;
        const yearKey = year.toString();

        let csv = '\uFEFF';
        csv += `${year}년 회비 납부현황\n민족통일청년회 영동군 지부\n\n`;
        csv += '회원명,직책,납부상태,납부일,금액\n';

        let paidCount = 0, totalAmount = 0;
        for (const member of membersData) {
          const payment = duesData[yearKey] ? duesData[yearKey][member.name] : null;
          const isPaid = payment && payment.paid;
          if (isPaid) { paidCount++; totalAmount += payment.amount; }
          csv += `${member.name},${member.role},${isPaid ? '완납' : '미납'},${isPaid ? payment.date : '-'},${isPaid ? payment.amount : 0}\n`;
        }
        csv += `\n합계,완납 ${paidCount}명 / 미납 ${membersData.length - paidCount}명,,,${totalAmount}\n`;

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `회비납부현황_${year}년.csv`;
        link.click();
      }

      function resetAllData() {
        if (!confirm('모든 데이터를 초기화하시겠습니까?\n\n· 잔고: 3,734,393원\n· 거래 내역: 초기화\n· 회비 납부: 전원 미납')) return;

        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(DUES_STORAGE_KEY);

        accountingData = loadData();
        duesData = loadDuesData();

        loadAll(currentYear);
        renderDuesTable(currentYear);
        alert('초기화 완료\n\n잔고: 3,734,393원');
      }

      // 이벤트 리스너
      document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('incomeDate').value = today;
        document.getElementById('expenseDate').value = today;

        loadAll(currentYear);
        renderDuesTable(currentYear);

        // 연도 필터
        document.querySelectorAll('.year-tabs .btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.year-tabs .btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentYear = parseInt(this.dataset.year);
            loadAll(currentYear);
            renderDuesTable(currentYear);
          });
        });

        // 탭 전환
        document.querySelectorAll('.view-tabs .tab-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.view-tabs .tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            document.querySelectorAll('.tab-content-area').forEach(area => area.classList.remove('active'));
            document.getElementById(this.dataset.tab + 'Tab').classList.add('active');
          });
        });

        // 버튼들
        document.getElementById('addIncomeBtn').addEventListener('click', () => {
          document.getElementById('incomeForm').reset();
          document.getElementById('incomeDate').value = new Date().toISOString().split('T')[0];
          new bootstrap.Modal(document.getElementById('incomeModal')).show();
        });

        document.getElementById('addExpenseBtn').addEventListener('click', () => {
          document.getElementById('expenseForm').reset();
          document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
          new bootstrap.Modal(document.getElementById('expenseModal')).show();
        });

        document.getElementById('saveIncomeBtn').addEventListener('click', saveIncome);
        document.getElementById('saveExpenseBtn').addEventListener('click', saveExpense);
        document.getElementById('confirmDeleteBtn').addEventListener('click', executeDelete);
        document.getElementById('excelBtn').addEventListener('click', exportToExcel);
        document.getElementById('reportBtn').addEventListener('click', generateReport);
        document.getElementById('reportExcelBtn').addEventListener('click', exportReportToExcel);
        document.getElementById('reportPrintBtn').addEventListener('click', printReport);
        document.getElementById('duesExcelBtn').addEventListener('click', exportDuesToExcel);
        document.getElementById('resetDataBtn').addEventListener('click', resetAllData);
      });
    </script>

  </body>

</html>
